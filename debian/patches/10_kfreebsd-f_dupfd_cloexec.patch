Author: Emilio Pozuelo Monfort <pochu@debian.org>
Author: Petr Salinger <Petr.Salinger@seznam.cz>
Bug-Debian: http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=711529
Description: Fix build on kfreebsd

kfreebsd doesn't have F_DUPFD_CLOEXEC, so use it conditionally.
As mentioned in the bug report, it will have support for it in
jessie, so we can drop it in jessie+1.

Index: gnome-terminal-3.20.2/src/terminal-screen.c
===================================================================
--- gnome-terminal-3.20.2.orig/src/terminal-screen.c
+++ gnome-terminal-3.20.2/src/terminal-screen.c
@@ -196,6 +196,20 @@ static TerminalURLFlavor *extra_regex_fl
 static guint n_url_regexes;
 static guint n_extra_regexes;
 
+#ifdef F_DUPFD_CLOEXEC
+static inline int dup_cloexec(int fd, int hint)
+{
+  return fcntl (fd, F_DUPFD_CLOEXEC, hint);
+}
+#else
+static inline int dup_cloexec(int fd, int hint)
+{
+  if ((fd = fcntl (fd, F_DUPFD, hint)) == -1)
+    return -1;
+  return fcntl (fd, F_SETFD, FD_CLOEXEC);
+}
+#endif
+
 /* See bug #697024 */
 #ifndef __linux__
 
@@ -1333,7 +1347,7 @@ terminal_screen_child_setup (FDSetupData
       for (j = 0; j < n_fds; j++) {
         if (fds[j] == target_fd) {
           do {
-            fd = fcntl (fds[j], F_DUPFD_CLOEXEC, 3);
+            fd = dup_cloexec(fds[j], 3);
           } while (fd == -1 && errno == EINTR);
           if (fd == -1)
             _exit (127);
